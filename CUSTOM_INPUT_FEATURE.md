# Функциональность пользовательского ввода в опросах

## Описание
Реализована функциональность для обработки вариантов ответов типа "Boshqa (o'z variantingizni yozing)" и их русских аналогов. При выборе таких вариантов поле автоматически превращается в инпут, где пользователь может сразу писать свой ответ. Ответ автоматически сохраняется при переходе к следующему вопросу.

## Добавленные файлы

### 1. `/src/utils/customInputDetection.js`
Утилита для определения вариантов ответов, которые требуют пользовательский ввод:
- `isCustomInputOption(option)` - проверяет, является ли вариант пользовательским вводом
- `getCustomInputPlaceholder(option, language)` - возвращает текст плейсхолдера

## Модифицированные файлы

### 1. `/src/components/TallySurvey.jsx`
- Добавлены импорты для новой функциональности
- Добавлено состояние `activeCustomInput` для отслеживания активного inline ввода
- Модифицирована функция `handleAnswerChange` для обработки пользовательских вариантов
- Добавлены функции `handleCustomInputChange` и `handleCustomInputBlur` для inline ввода
- Обновлен рендеринг вариантов ответов для поддержки inline ввода
- Удален компонент `CustomInputModal` из рендера

### 2. `/src/components/Main/SurveyModal.jsx`
- Добавлены импорты для новой функциональности
- Добавлено состояние `activeCustomInput` для отслеживания активного inline ввода
- Модифицирована функция `handleAnswer` для обработки пользовательских вариантов
- Добавлены функции `handleCustomInputChange` и `handleCustomInputBlur` для inline ввода
- Обновлен рендеринг вариантов ответов для поддержки inline ввода
- Удален компонент `CustomInputModal` из рендера

## Поддерживаемые варианты ответов

### Узбекские варианты:
- "Boshqa (o'z variantingizni yozing)"
- "Boshqa"
- "o'z variantingizni yozing"
- "o'z javobingizni yozing"
- "Boshqa javob"

### Русские варианты:
- "Другое (напишите свой вариант)"
- "Другое"
- "напишите свой вариант"
- "напишите свой ответ"
- "Другой ответ"
- "Свой вариант"

### Английские варианты:
- "Other (write your own)"
- "Other"
- "write your own"
- "write your answer"
- "Custom answer"
- "Your own answer"

## Как это работает

1. При выборе варианта ответа система проверяет, является ли он пользовательским вводом
2. Если да, поле автоматически превращается в инпут с фокусом
3. Пользователь вводит свой ответ прямо в этом поле
4. **Промежуточные значения НЕ сохраняются** - только финальный результат при потере фокуса или переходе к следующему вопросу
5. При потере фокуса (onBlur) или переходе к следующему вопросу инпут закрывается
6. Пользователь может продолжить опрос

### Особенности сохранения:

- **Отложенное сохранение**: Промежуточные значения при вводе НЕ сохраняются в финальные ответы
- **Финальное сохранение**: Сохранение происходит только при потере фокуса (onBlur) или переходе к следующему вопросу
- **Предотвращение дублирования**: Это предотвращает сохранение всех промежуточных символов при вводе

### Особенности для multichoice (чекбоксы):

- **Сохранение всех вариантов**: При выборе пользовательского варианта в multichoice сохраняются все выбранные варианты (обычные + пользовательский ввод)
- **Массив ответов**: Для multichoice ответы сохраняются как массив строк
- **Комбинированный выбор**: Можно выбрать несколько обычных вариантов и добавить свой пользовательский ответ
- **Автоматическая замена**: При вводе пользовательского текста оригинальный вариант "Boshqa (o'z variantingizni yozing)" заменяется на введенный текст

## Особенности

- **Inline ввод**: Поле превращается в инпут прямо на месте, без модальных окон
- **Автоматическое сохранение**: Ответ сохраняется автоматически при вводе
- **Автоматический фокус**: При активации инпут сразу получает фокус
- **Автоматическое закрытие**: Инпут закрывается при потере фокуса
- **Поддержка клавиатуры**: Полная поддержка мобильной клавиатуры
- **Локализация**: Плейсхолдеры на узбекском, русском и английском языках
- **Адаптивный дизайн**: Работает на всех устройствах
- **Поддержка чекбоксов**: Функциональность работает и для множественного выбора
- **Интеграция**: Полная интеграция с существующей системой опросов

## Технические детали

- Состояние `activeCustomInput` содержит `{questionId, optionIndex, value}`
- Функция `handleCustomInputChange` обновляет только промежуточное значение в состоянии, НЕ сохраняет в финальные ответы
- Функция `handleCustomInputBlur` сохраняет финальное значение в ответы и закрывает инпут
- Функция `saveCustomInputIfActive` принудительно сохраняет активный ввод (вызывается при переходе к следующему вопросу)
- Рендеринг условно показывает либо обычный вариант, либо инпут
- Поддержка как радио-кнопок, так и чекбоксов

### Логика сохранения:

- **onChange**: Обновляет только промежуточное значение в `activeCustomInput.value`
- **onBlur**: Сохраняет финальное значение в `answers` и закрывает инпут
- **Переход к следующему вопросу**: Вызывает `saveCustomInputIfActive()` для принудительного сохранения
- **Завершение опроса**: Вызывает `saveCustomInputIfActive()` перед отправкой данных

### Логика для multichoice:

- **Определение типа вопроса**: Система определяет тип вопроса (choice/multichoice) для правильной обработки
- **Обработка массива**: Для multichoice ответы обрабатываются как массив, для choice - как строка
- **Фильтрация вариантов**: При вводе пользовательского текста оригинальный вариант удаляется из массива
- **Комбинирование**: Новый пользовательский текст добавляется к существующим выбранным вариантам
- **Валидация**: Пустые значения пользовательского ввода не добавляются в массив
